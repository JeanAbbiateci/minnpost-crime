/*! minnpost-crime - v0.0.1 - 2013-06-14
* https://github.com/MinnPost/minnpost-crime
* Copyright (c) 2013 ; Licensed MIT */

var mpApp=mpApp||{};mpApp["minnpost-crime"]=mpApp["minnpost-crime"]||{},_.mixin({formatCurrency:function(e){var t=/(\d+)(\d{3})/;for(split=(""+e.toFixed(2)).split(".");t.test(split[0]);)split[0]=split[0].replace(t,"$1,$2");return"$"+split[0]+"."+split[1]},formatPercentage:function(e){return""+(100*e).toFixed(1)+"%"}}),_.isFunction(Backbone.$.jsonp)&&(Backbone.ajax=function(){return Backbone.$.jsonp.apply(Backbone.$,arguments)}),function(e,t){e.defaultOptions={dataPath:"./"},e.templates=e.templates||{},e.getTemplate=function(n,o,i){var a="js/templates/"+n+".html";i=i||e,_.isUndefined(e.templates[a])?t.ajax({url:a,method:"GET",async:!1,contentType:"text",success:function(t){e.templates[a]=_.template(t),o.apply(i,[e.templates[a]])}}):o.apply(i,[e.templates[a]])},e.data=e.data||{},e.getData=function(n){var o="http://mp-jsonproxy.herokuapp.com/proxy?callback=?&url=",i=!1,a=[];return n=_.isArray(n)?n:[n],e.options&&0===e.options.dataPath.indexOf("http")&&(i=!0),_.each(n,function(n){var r;r=i?t.jsonp({url:o+encodeURI(e.options.dataPath+n+".json")}):t.getJSON(e.options.dataPath+n+".json"),a.push(r)}),t.when.apply(t,a)}}(mpApp["minnpost-crime"],jQuery),function(e){e.Application=Backbone.Router.extend({routes:{"city/:city":"routeCity","neighborhood/:city/:neighborhood":"routeNeighborhood","*defaultR":"routeDefault"},initialize:function(t){_.bindAll(this),e.options=_.extend(e.defaultOptions,t),this.applicationView=new e.ViewContainer({el:e.options.el}).render().renderGeneralLoading(),this.start()},start:function(){Backbone.history.start()},routeDefault:function(){this.navigate("/city/minneapolis",{trigger:!0,replace:!0})},routeCity:function(){},neighborhood:function(){}}),e.start=function(t){return e.router=new e.Application(t),e}}(mpApp["minnpost-crime"],jQuery),function(e){e.ModelCity=Backbone.Model.extend({}),e.ModelNeighborhood=Backbone.Model.extend({})}(mpApp["minnpost-crime"],jQuery),function(e){e.CollectionCities=Backbone.Collection.extend({model:e.ModelCity}),e.CollectionNeighborhoods=Backbone.Collection.extend({model:e.ModelNeighborhood})}(mpApp["minnpost-crime"],jQuery),function(e,t){e.ViewContainer=Backbone.View.extend({render:function(){return e.getTemplate("template-application-container",function(e){t(this.el).html(e({}))},this),this},renderLoading:function(n){var o=_.isUndefined(n)?t(this.el):t(this.el).find(n);return e.getTemplate("template-loading",function(e){o.html(e({}))},this),this},renderGeneralLoading:function(){return this.renderLoading(".general-loading .col"),t(".general-loading").slideDown(),this},renderStopGeneralLoading:function(){return this.$el.find(".general-loading").slideUp(),this}})}(mpApp["minnpost-crime"],jQuery);